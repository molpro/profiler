if (CMAKE_Fortran_COMPILER_ID)
    set(PROFILER_FORTRAN_SRCS "ProfilerF.F90")
    set(PROFILER_FORTRAN 1)
endif ()
add_library(Profiler Profiler.cpp Profiler.h ${PROFILER_FORTRAN_SRCS})

if (Molpro_SOURCE_DIR)
    target_compile_definitions(Profiler PRIVATE MOLPRO)
    target_link_libraries(Profiler PRIVATE ppidd::ppidd memory::memory)
endif ()

if (MPI_CXX_FOUND)
    message(STATUS "Building with MPI")
    set(HAVE_MPI_H 1)
    target_compile_definitions(Profiler PUBLIC HAVE_MPI_H)
    target_link_libraries(Profiler PUBLIC MPI::MPI_CXX)
endif ()

if ("${CMAKE_CXX_COMPILER_ID}" STREQUAL "PGI")
    target_compile_definitions(Profiler PRIVATE -DEIGEN_DONT_VECTORIZE)
endif ()

if (Molpro_SOURCE_DIR)
    get_dependency(ppidd)
    get_dependency(memory)
    configure_library(${PROJECT_NAME} ppidd memory)
else ()
    configure_library(${PROJECT_NAME})
endif ()
